# ----------------------------------------------------------------------
# Security & Basic Configuration
# ----------------------------------------------------------------------
Options -Indexes
ServerSignature Off

# Prevent file injection
SetEnvIfNoCase User-Agent ".*" bad_bot
<Limit GET POST HEAD>
    Order Allow,Deny
    Allow from all
    Deny from env=bad_bot
</Limit>

# ----------------------------------------------------------------------
# Security Headers
# ----------------------------------------------------------------------
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "DENY"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    Header set Content-Security-Policy "default-src 'self'"
    
    # Remove X-Powered-By header
    Header unset X-Powered-By
</IfModule>

# ----------------------------------------------------------------------
# SSL Enforcement (Uncomment in production)
# ----------------------------------------------------------------------
# <IfModule mod_rewrite.c>
#     RewriteEngine On
#     RewriteCond %{HTTPS} !=on
#     RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
# </IfModule>

# ----------------------------------------------------------------------
# URL Rewriting
# ----------------------------------------------------------------------
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # Redirect Trailing Slashes If Not A Folder...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)/$ /$1 [L,R=301]

    # Handle Front Controller...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [L]
</IfModule>

# ----------------------------------------------------------------------
# Custom Error Documents
# ----------------------------------------------------------------------
ErrorDocument 400 /400.php
ErrorDocument 401 /401.php
ErrorDocument 403 /403.php
ErrorDocument 404 /404.php
ErrorDocument 500 /500.php
ErrorDocument 503 /503.php

# ----------------------------------------------------------------------
# File Protection
# ----------------------------------------------------------------------
<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

<FilesMatch "\.(env|htaccess|htpasswd|ini|log|sh|sql)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# Block access to vendor and node_modules
RedirectMatch 404 /\..*$
RedirectMatch 404 /vendor/.*$
RedirectMatch 404 /node_modules/.*$

# Prevent PHP execution in uploads
<DirectoryMatch "^/uploads/">
    <FilesMatch "\.php$">
        Order Deny,Allow
        Deny from all
    </FilesMatch>
</DirectoryMatch>

# ----------------------------------------------------------------------
# Performance Optimizations
# ----------------------------------------------------------------------
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/css application/json
    AddOutputFilterByType DEFLATE application/javascript text/javascript
    AddOutputFilterByType DEFLATE text/xml application/xml image/svg+xml
</IfModule>

<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/x-javascript "access plus 1 month"
    ExpiresByType application/x-shockwave-flash "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresDefault "access plus 2 days"
</IfModule>

# ----------------------------------------------------------------------
# Hotlink Protection
# ----------------------------------------------------------------------
<IfModule mod_rewrite.c>
    RewriteEngine on
    RewriteCond %{HTTP_REFERER} !^$
    RewriteCond %{HTTP_REFERER} !^https://(www\.)?example\.com/.*$ [NC]
    RewriteRule \.(jpg|jpeg|png|gif|svg|css|js)$ - [F]
</IfModule>

# ----------------------------------------------------------------------
# MIME Types
# ----------------------------------------------------------------------
<IfModule mod_mime.c>
    AddType image/svg+xml svg svgz
    AddType application/font-woff2 .woff2
    AddType application/x-font-ttf .ttf
    AddType application/vnd.ms-fontobject .eot
    AddType application/font-sfnt .otf
</IfModule>
